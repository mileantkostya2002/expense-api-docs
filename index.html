<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Expense Management API Documentation</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui.css" />
    <link rel="icon" type="image/png" href="https://unpkg.com/swagger-ui-dist@5.10.5/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="https://unpkg.com/swagger-ui-dist@5.10.5/favicon-16x16.png" sizes="16x16" />
    <style>
        html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
        }

        *, *:before, *:after {
            box-sizing: inherit;
        }

        body {
            margin: 0;
            background: #fafafa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        }

        .swagger-ui .topbar {
            background-color: #1f2937;
            border-bottom: 1px solid #374151;
        }

        .swagger-ui .topbar .link {
            color: #f9fafb;
        }

        .swagger-ui .info .title {
            color: #1f2937;
        }

        /* Custom header styling */
        .custom-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-bottom: 0;
        }

        .custom-header h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .custom-header p {
            margin: 0;
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .custom-header .badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            margin-top: 1rem;
        }

        /* Hide the default info section title since we have custom header */
        .swagger-ui .info .title {
            display: none;
        }

        /* Environment selector styling */
        .env-selector {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem;
            text-align: center;
        }

        .env-selector select {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .env-selector select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Authentication info styling */
        .auth-info {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem auto 2rem;
            max-width: 800px;
        }

        .auth-info h3 {
            margin: 0 0 0.5rem 0;
            color: #374151;
        }

        .auth-info p {
            margin: 0.5rem 0;
            color: #6b7280;
            line-height: 1.5;
        }

        .auth-example {
            background: #1f2937;
            color: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
    </style>
</head>

<body>
    <!-- Custom Header -->
    <div class="custom-header">
        <div class="container">
            <h1>Enterprise Expense Management API</h1>
            <p>Comprehensive REST API for managing employee expenses, reports, and attachments</p>
            <span class="badge">Version 1.0.0</span>
        </div>
    </div>

    <!-- Environment Selector -->
    <div class="env-selector">
        <label for="env-select" style="margin-right: 1rem; font-weight: 600;">Environment:</label>
        <select id="env-select" onchange="changeEnvironment()">
            <option value="https://erp.company.com/api">Production</option>
            <option value="https://staging-erp.company.com/api">Staging</option>
        </select>
    </div>

    <!-- Authentication Information -->
    <div class="auth-info">
        <h3>üîê Authentication</h3>
        <p>This API uses Bearer token authentication. Include your employee API token in the Authorization header:</p>
        <div class="auth-example">Authorization: Bearer YOUR_API_TOKEN_HERE</div>
        <p><strong>Note:</strong> Some endpoints (categories, vendors) are public and don't require authentication.</p>
    </div>

    <!-- Swagger UI Container -->
    <div id="swagger-ui"></div>

    <script src="https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui-standalone-preset.js"></script>

    <script>
        // OpenAPI specification embedded directly in the HTML
        const spec = {
            "openapi": "3.0.3",
            "info": {
                "title": "Enterprise Expense Management API",
                "description": "Comprehensive REST API for managing employee expenses, reports, and attachments in enterprise environments.\n\n**Authentication**: All protected endpoints require Bearer token authentication using employee API tokens.\n\n**Rate Limiting**: API calls are subject to rate limiting policies.\n\n**Data Format**: All dates follow ISO 8601 format (YYYY-MM-DD), timestamps include timezone information.",
                "version": "1.0.0",
                "contact": {
                    "name": "API Support Team",
                    "email": "api-support@company.com"
                },
                "license": {
                    "name": "Proprietary",
                    "url": "https://company.com/license"
                }
            },
            "servers": [
                {
                    "url": "https://erp.company.com/api",
                    "description": "Production Environment"
                },
                {
                    "url": "https://staging-erp.company.com/api",
                    "description": "Staging Environment"
                }
            ],
            "security": [
                {
                    "BearerAuth": []
                }
            ],
            "components": {
                "securitySchemes": {
                    "BearerAuth": {
                        "type": "http",
                        "scheme": "bearer",
                        "bearerFormat": "JWT",
                        "description": "Employee API token for authentication"
                    }
                },
                "schemas": {
                    "Employee": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "description": "Unique employee identifier",
                                "example": 1001
                            },
                            "name": {
                                "type": "string",
                                "description": "Full employee name",
                                "example": "Sarah Johnson"
                            },
                            "company_id": {
                                "type": "integer",
                                "description": "Associated company identifier",
                                "example": 5
                            },
                            "company_name": {
                                "type": "string",
                                "description": "Company name",
                                "example": "TechCorp Solutions"
                            }
                        }
                    },
                    "Company": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "description": "Unique company identifier",
                                "example": 5
                            },
                            "name": {
                                "type": "string",
                                "description": "Company legal name",
                                "example": "TechCorp Solutions"
                            }
                        }
                    },
                    "Product": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "description": "Product category identifier",
                                "example": 150
                            },
                            "name": {
                                "type": "string",
                                "description": "Expense category name",
                                "example": "Business Travel & Transportation"
                            }
                        }
                    },
                    "Vendor": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "description": "Vendor identifier",
                                "example": 2500
                            },
                            "name": {
                                "type": "string",
                                "description": "Vendor company name",
                                "example": "Global Business Services Ltd"
                            }
                        }
                    },
                    "Vehicle": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "description": "Fleet vehicle identifier",
                                "example": 45
                            },
                            "name": {
                                "type": "string",
                                "description": "Vehicle identification",
                                "example": "BMW X3 - License: BZ-4587-XY"
                            }
                        }
                    },
                    "Task": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "description": "Project task identifier",
                                "example": 3200
                            },
                            "name": {
                                "type": "string",
                                "description": "Task name",
                                "example": "Client System Implementation - Phase 2"
                            },
                            "partner_id": {
                                "type": "integer",
                                "nullable": true,
                                "description": "Associated client/partner identifier",
                                "example": 850
                            },
                            "partner_name": {
                                "type": "string",
                                "nullable": true,
                                "description": "Client/partner name",
                                "example": "Manufacturing Corp International"
                            },
                            "project_id": {
                                "type": "integer",
                                "nullable": true,
                                "description": "Parent project identifier",
                                "example": 180
                            },
                            "project_name": {
                                "type": "string",
                                "nullable": true,
                                "description": "Project name",
                                "example": "ERP Implementation Q1 2024"
                            }
                        }
                    },
                    "Tax": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "description": "Tax rule identifier",
                                "example": 8
                            },
                            "name": {
                                "type": "string",
                                "description": "Tax description",
                                "example": "Value Added Tax 19%"
                            },
                            "amount": {
                                "type": "number",
                                "format": "float",
                                "description": "Tax percentage rate",
                                "example": 19.0
                            }
                        }
                    },
                    "Attachment": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "description": "Attachment identifier",
                                "example": 7890
                            },
                            "name": {
                                "type": "string",
                                "description": "Original filename",
                                "example": "business_receipt_20240115.pdf"
                            },
                            "mimetype": {
                                "type": "string",
                                "description": "File MIME type",
                                "example": "application/pdf"
                            },
                            "file_size": {
                                "type": "integer",
                                "description": "File size in bytes",
                                "example": 1048576
                            },
                            "create_date": {
                                "type": "string",
                                "format": "date-time",
                                "description": "Upload timestamp",
                                "example": "2024-01-15T09:30:00Z"
                            }
                        }
                    },
                    "Error": {
                        "type": "object",
                        "properties": {
                            "error": {
                                "type": "string",
                                "description": "Error message",
                                "example": "Unauthorized access. Valid API token required."
                            },
                            "details": {
                                "type": "object",
                                "description": "Additional error details",
                                "nullable": true
                            }
                        }
                    }
                }
            },
            "paths": {
                "/v1/expenses": {
                    "get": {
                        "summary": "List Employee Expenses",
                        "description": "Retrieve paginated list of expenses for authenticated employee with advanced filtering options.\n\n**Default Behavior**: Returns current month expenses only unless date filters are specified.",
                        "security": [
                            {
                                "BearerAuth": []
                            }
                        ],
                        "parameters": [
                            {
                                "name": "limit",
                                "in": "query",
                                "description": "Maximum records to return (1-100)",
                                "schema": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 100,
                                    "default": 20,
                                    "example": 25
                                }
                            },
                            {
                                "name": "offset",
                                "in": "query",
                                "description": "Number of records to skip for pagination",
                                "schema": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "default": 0,
                                    "example": 50
                                }
                            },
                            {
                                "name": "state",
                                "in": "query",
                                "description": "Filter by expense status",
                                "schema": {
                                    "type": "string",
                                    "enum": ["draft", "reported", "approved", "done", "refused"],
                                    "example": "draft"
                                }
                            },
                            {
                                "name": "date_from",
                                "in": "query",
                                "description": "Start date filter (ISO 8601)",
                                "schema": {
                                    "type": "string",
                                    "format": "date",
                                    "example": "2024-01-01"
                                }
                            },
                            {
                                "name": "date_to",
                                "in": "query",
                                "description": "End date filter (ISO 8601)",
                                "schema": {
                                    "type": "string",
                                    "format": "date",
                                    "example": "2024-01-31"
                                }
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Expenses retrieved successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean",
                                                    "example": true
                                                },
                                                "data": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "object",
                                                        "properties": {
                                                            "id": {
                                                                "type": "integer",
                                                                "example": 45230
                                                            },
                                                            "name": {
                                                                "type": "string",
                                                                "example": "Airport parking and transportation costs"
                                                            },
                                                            "total_amount_currency": {
                                                                "type": "number",
                                                                "example": 187.50
                                                            },
                                                            "currency": {
                                                                "type": "string",
                                                                "example": "EUR"
                                                            },
                                                            "state": {
                                                                "type": "string",
                                                                "example": "draft"
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Authentication required",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/Error"
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/v1/expense/categories": {
                    "get": {
                        "summary": "List Expense Categories",
                        "description": "Retrieve available expense categories for expense creation.\n\n**Public Endpoint**: No authentication required - provides reference data for expense categorization.",
                        "responses": {
                            "200": {
                                "description": "Categories retrieved successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean",
                                                    "example": true
                                                },
                                                "categories": {
                                                    "type": "array",
                                                    "items": {
                                                        "$ref": "#/components/schemas/Product"
                                                    }
                                                },
                                                "count": {
                                                    "type": "integer",
                                                    "example": 25
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        };

        // Initialize Swagger UI
        let ui;

        function initSwaggerUI(serverUrl) {
            // Update the server URL in the spec
            spec.servers = [
                {
                    "url": serverUrl,
                    "description": serverUrl.includes('staging') ? "Staging Environment" : "Production Environment"
                }
            ];

            if (ui) {
                ui.specActions.updateSpec(JSON.stringify(spec));
            } else {
                ui = SwaggerUIBundle({
                    url: '',
                    spec: spec,
                    dom_id: '#swagger-ui',
                    deepLinking: true,
                    presets: [
                        SwaggerUIBundle.presets.apis,
                        SwaggerUIStandalonePreset
                    ],
                    plugins: [
                        SwaggerUIBundle.plugins.DownloadUrl
                    ],
                    layout: "StandaloneLayout",
                    validatorUrl: null,
                    tryItOutEnabled: true,
                    requestInterceptor: (request) => {
                        // Log API calls for debugging
                        console.log('API Request:', request);
                        return request;
                    },
                    responseInterceptor: (response) => {
                        // Log API responses for debugging
                        console.log('API Response:', response);
                        return response;
                    }
                });
            }
        }

        function changeEnvironment() {
            const select = document.getElementById('env-select');
            const selectedUrl = select.value;
            initSwaggerUI(selectedUrl);
        }

        // Initialize with production environment
        window.addEventListener('load', () => {
            initSwaggerUI('https://erp.company.com/api');
        });

        // Add some helpful console messages
        console.log('üöÄ Expense Management API Documentation loaded');
        console.log('üí° Tip: Use the environment selector to switch between production and staging');
        console.log('üîê Don\'t forget to add your Bearer token in the "Authorize" button');
    </script>
</body>
</html>
